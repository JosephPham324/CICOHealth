<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./css/foodsearch.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"
      integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <title>Search Food</title>
  </head>
  <body>
    <div class="food-search">
      <div class="search-wrapper">
        <label for="search">Search Food</label>
        <div class="input">
          <i class="fa-solid fa-magnifying-glass button"></i>
          <input type="text" id="search" placeholder="brisket and cheese and fries"/>
        </div>
      </div>
      <div class="search-results">
        <div class="food">
          <div class="header">brisket</div>
          <div class="serving">brisket, 100g</div>
          <div class="nutrition-facts">
            <span class="calories">Calories 289.3</span><br/>
            <span class="protein"><i class="fas fa-egg"></i>P 29.1g</span>
            <span class="fat"><i class="fas fa-cheese"></i>F 18.3g</span>
            <span class="carbs"
              ><i class="fas fa-bread-slice"></i>C 0g</span
            >
          </div>
        </div>
        <div class="food">
          <div class="header">cheese</div>
          <div class="serving">cheese, 100g</div>
          <div class="nutrition-facts">
            <span class="calories">Calories 393.9</span><br />
            <span class="protein"><i class="fas fa-egg"></i>P 22.7g</span>
            <span class="fat"><i class="fas fa-cheese"></i>F 33g</span>
            <span class="carbs"
              ><i class="fas fa-bread-slice"></i>C 3.2g</span
            >
          </div>
        </div>
      </div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
      let apiKey = "06Ve1mf2SCu8Ex1P/f6MVg==2N8rX79akXJaUwPS";
      let query;
      let button = document.querySelector(".search-wrapper .button");
      let input = document.querySelector(".search-wrapper input");
      let queryResult;
      function searchFood(query) {
        console.log("https://api.api-ninjas.com/v1/nutrition?query=" + query);
        var data = null;
        $.ajax({
          method: "GET",
          url: "https://api.api-ninjas.com/v1/nutrition?query=" + query,
          headers: { "X-Api-Key": apiKey },
          contentType: "application/json",
          success: function (result) {
            clearResults();
            result.forEach((item) => {
              console.log(item);
              let element = createResultElement(
                item.name,
                item.serving_size_g,
                item.calories,
                item.protein_g,
                item.fat_total_g,
                item.carbohydrates_total_g
              );
              console.log(element);
              appendToResults(element);
            });
          },
          error: function ajaxError(jqXHR) {
            console.error("Error: ", jqXHR.responseText);
          },
        });
        return data;
      }
      button.addEventListener("click", () => {
        query = input.value;
        searchFood(query);
      });

      function clearResults() {
        let results = document.querySelector(".search-results");
        results.innerHTML = "";
      }
      function appendToResults(resultElement) {
        let results = document.querySelector(".search-results");
        results.appendChild(resultElement);
      }
      function createResultElement(
        name,
        servingAmount,
        calories,
        protein,
        fat,
        carbs
      ) {
        let text = `
          <div class="header">${name}</div>
          <div class="serving">${name}, ${servingAmount}g</div>
          <div class="nutrition-facts">
            <span class="calories">Calories ${calories}</span><br>
            <span class="protein"><i class='fas fa-egg'></i>P ${protein}g</span>
            <span class="fat"><i class='fas fa-cheese'></i>F ${fat}g</span>
            <span class="carbs"><i class ='fas fa-bread-slice'></i>C ${carbs}g</span>
          </div>
          `;
        let element = document.createElement("div");
        element.classList.add("food");
        element.innerHTML = text;
        return element;
      }
    </script>
  </body>
</html>
